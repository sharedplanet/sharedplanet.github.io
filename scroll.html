<!DOCTYPE html>
<meta charset="utf-8" />
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet" />
<style>
  body {
    font-family: 'Poppins', sans-serif;
    margin: 20px;
    color: #000;
    text-align: left;
    max-width: 700px;
    margin-left: auto;
    margin-right: auto;
  }
  #headline {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 6px;
    color: #000;
    text-align: left;
  }
  #subheadline {
    font-size: 18px;
    font-weight: 500;
    margin-bottom: 20px;
    color: #333;
    text-align: left;
  }
  #counter {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 8px;
  }
  .tooltip {
    position: absolute;
    background: white;
    border: 1px solid #ccc;
    padding: 6px 10px;
    border-radius: 4px;
    pointer-events: none;
    font-size: 14px;
    opacity: 0;
    transition: opacity 0.3s;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  svg {
    display: block;
    margin-left: 0;
  }
  .percent-label {
    font-weight: 700;
    fill: #cc0000;
    font-size: 18.5px;
    opacity: 1;
  }
  #chart-container {
    margin-top: 40px;
    min-height: 350px;
  }
</style>
<body>
<h4 align="center"> Please scroll below to observe the animation. Numbers are purely for illustrative purposes and do not reflect actual numbers. </h4>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<div id="chart-container">
  <div id="headline">Refugee Costs as % of Total ODA Are Rising</div>
  <div id="subheadline">Tracking the annual share of refugee-related aid from 2005 to 2010</div>
  <div id="counter"></div>
</div>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>

<p>Additional content after chart...</p>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
const data = [
  { year: 2005, share: 5.2 },
  { year: 2006, share: 5.8 },
  { year: 2007, share: 6.1 },
  { year: 2008, share: 7.3 },
  { year: 2009, share: 8.9 },
  { year: 2010, share: 9.4 }
];

const margin = {top: 30, right: 60, bottom: 30, left: 50},
      width = 600 - margin.left - margin.right,
      height = 300 - margin.top - margin.bottom;

const svg = d3.select("#chart-container")
  .append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
  .style("opacity", 0)
  .append("g")
  .attr("transform", `translate(${margin.left},${margin.top})`);

const x = d3.scaleLinear()
  .domain(d3.extent(data, d => d.year))
  .range([0, width]);

const y = d3.scaleLinear()
  .domain([0, d3.max(data, d => d.share)]).nice()
  .range([height, 0]);

svg.append("g")
  .attr("transform", `translate(0,${height})`)
  .call(
    d3.axisBottom(x)
      .tickValues(data.map(d => d.year))
      .tickFormat(d3.format("d"))
  )
  .selectAll("text")
  .attr("fill", "#000");

svg.append("g")
  .call(
    d3.axisLeft(y)
      .ticks(6)
      .tickFormat(d => d + "%")
  )
  .selectAll("text")
  .attr("fill", "#000");

const line = d3.line()
  .x(d => x(d.year))
  .y(d => y(d.share));

const area = d3.area()
  .x(d => x(d.year))
  .y0(height)
  .y1(d => y(d.share));

const areaPath = svg.append("path")
  .datum(data)
  .attr("fill", "#f4cccc")
  .attr("opacity", 0)
  .attr("d", area);

const linePath = svg.append("path")
  .datum(data)
  .attr("fill", "none")
  .attr("stroke", "#cc0000")
  .attr("stroke-width", 2)
  .attr("d", line);

const totalLength = linePath.node().getTotalLength();

linePath
  .attr("stroke-dasharray", totalLength + " " + totalLength)
  .attr("stroke-dashoffset", totalLength);

const pointGroup = svg.append("g")
  .style("opacity", 0);

pointGroup.selectAll("circle")
  .data(data)
  .enter()
  .append("circle")
  .attr("cx", d => x(d.year))
  .attr("cy", d => y(d.share))
  .attr("r", 6)
  .attr("fill", "#cc0000");

const percentLabels = svg.append("g")
  .attr("class", "percent-labels")
  .style("opacity", 0);

percentLabels.selectAll("text")
  .data([data[0], data[data.length - 1]])
  .enter()
  .append("text")
  .attr("class", "percent-label")
  .attr("x", (d, i) => i === 0 ? x(d.year) - 51 : x(d.year) + 10)
  .attr("y", (d, i) => i === 0 ? y(d.share) + 8 : y(d.share) + 5)
  .text(d => d.share.toFixed(1) + "%");

const tooltip = d3.select("body").append("div")
  .attr("class", "tooltip");

pointGroup.selectAll("circle")
  .on("mouseover", (event, d) => {
    tooltip.style("opacity", 1)
      .html(`<strong>${d.year}</strong><br/>${d.share}% share`)
      .style("left", (event.pageX + 10) + "px")
      .style("top", (event.pageY - 28) + "px");
  })
  .on("mousemove", (event) => {
    tooltip.style("left", (event.pageX + 10) + "px")
           .style("top", (event.pageY - 28) + "px");
  })
  .on("mouseout", () => {
    tooltip.style("opacity", 0);
  });

const chartContainer = document.querySelector("#chart-container");

const observer = new IntersectionObserver(entries => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      d3.select(svg.node().parentNode).transition().duration(300).style("opacity", 1);

      linePath.transition()
        .duration(1500)
        .ease(d3.easeLinear)
        .attr("stroke-dashoffset", 0)
        .on("end", () => {
          areaPath.transition()
            .duration(800)
            .attr("opacity", 1);

          pointGroup.transition()
            .duration(300)
            .style("opacity", 1);

          percentLabels.transition()
            .duration(300)
            .style("opacity", 1);
        });
      
      observer.unobserve(chartContainer);
    }
  });
}, {
  root: null,
  threshold: 0.3
});

observer.observe(chartContainer);
</script>
</body>
